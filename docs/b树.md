## 1 b树的定义

B树是为磁盘或直接存取的辅助存储设备而设计的一种平衡搜索树，可以用来降低磁盘 I/O 操作次数。许多数据库系统使用 b树或者 b树变种来存储信息。b树和红黑树，平衡二叉树不同的是 b树的结点可以有很多个孩子。同样多个结点，b树的高度要比红黑树，平衡二叉树低得多。

因为磁盘寻道时间很长，所以通常读取一个页面的内容到主存上。对于存储在磁盘上的一颗大的 b树，通常分支因子在 50~2000 之间，具体取决于一个关键字相遇对一页的大小。一个大的分支因子可以大大降低树的高度以及查找任何一个关键字所需的磁盘读取次数。比如一个分支因子为 1001，高度为 2 的 b树最多可以包含 10 亿多个关键字。将根节点保存在主存中，这棵树的查找中查找任何关键字最多需要两次读取磁盘。

**b树的定义如下**：

一颗 b树 T 是具有以下性质的树。

1.   每个结点 x 都有以下属性
     -   x.n，当前存储在 x 结点中的关键字个数
     -   n 个关键字本身升序排列
     -   x.leaf，是一个布尔值，标记是否为叶结点
2.   每个内部结点 x 还包含 n+1 个指向其孩子的指针。叶结点的孩子指针为空。
3.   关键字对存储在各子树的关键字范围加以分隔。
4.   每个叶结点具有相同的深度，即树高 h。
5.   每个结点所包含的关键字个数有上界和下界。称为 b树的最小度数 t，t>=2：
     -   除了根节点以外的每个结点都必须至少有 t-1 个关键字。因此，除了根节点外的每个内部节点至少有 t 个孩子。
     -   每个结点至多有 2t-1 个关键字。因此一个内部结点最多可有 2t 个孩子。当一个结点有 2t-1 个关键字时，称该结点为满结点。

## 2 b树的查找，插入

要在B树中找到关键字 k，请遵循以下算法:

1.  从根节点开始，如果键存在于该节点中，则返回键值对，这样就完成了。如果它不存在，通过比较K和节点的键来确定下一步要考虑的正确子节点。

    如果ki-1 < K < ki，则正确的子节点是Ci。

2.  移动到Ci，重复步骤1，直到找到包含K的节点。

3.  如果到达一个叶节点而K未找到，则返回未找到键。

b树种插入一个关键字，遵循以下算法：

在 b树中插入是将新的关键字插入已经存在的叶结点上。如果待插入的叶结点是满结点，将这个满结点（有 2t-1 个关键字）按中间结点分裂为两个各含 t-1 个关键字的结点。中间关键字被提升到父结点，用来标识两颗新树的划分点。如果父结点也是满结点，就必须在插入新的关键字之前将其分裂，最终满结点的分裂将沿着树向上传播。

## 3 b树的删除

删除操作可以在任意结点中进行。而不像插入只能在叶结点。当从一个内部结点删除一个关键字时，要重新安排这个结点的孩子。雨插入操作一样，必须防止因删除操作而导致树的结构违反 b树的性质。就像必须必须保证一个结点不会因为插入而变得太大一样，必须保证一个结点不会在删除期间变得太小（根节点除外，因为它允许比最少关键字 t-1 还要少的关键字个数）。一个简单的插入算法，如果插入关键字的路径上结点满，可能需要向上回溯；与此类似的，一个简单删除算法，当要删除关键字的路径上结点又最少关键字个数时，也可能需要向上回溯。

1.   如果关键字 k 在结点 x 中，并且 x 是叶结点，则从 x 中删除 k。
2.   如果关键字 k 在结点 x 中，并且 x 是内部结点，则做如下操作：
     -   

